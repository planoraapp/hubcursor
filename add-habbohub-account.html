<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Adicionar Conta habbohub</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 1000px; margin: 0 auto; padding: 20px; background: #f5f5f5; }
        .container { background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .step { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        button { background: #007bff; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; margin: 5px; }
        .success { color: #28a745; }
        .error { color: #dc3545; }
        .info { color: #17a2b8; }
        .result { background: #f8f9fa; padding: 10px; border-radius: 3px; margin: 10px 0; white-space: pre-wrap; font-family: monospace; font-size: 12px; }
        .sql-code { background: #f8f9fa; padding: 15px; border-radius: 5px; font-family: monospace; font-size: 12px; overflow-x: auto; border: 1px solid #ddd; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîß Adicionar Conta habbohub</h1>
        
        <div class="step">
            <h3>üìã Informa√ß√µes da Conta:</h3>
            <p><strong>Nome:</strong> habbohub</p>
            <p><strong>Senha:</strong> 151092</p>
            <p><strong>Hotel:</strong> br (Brasil)</p>
            <p><strong>Admin:</strong> Sim</p>
        </div>

        <div class="step">
            <h3>üîç 1. Verificar contas existentes</h3>
            <button onclick="checkExistingAccounts()">Verificar Contas</button>
            <div id="checkResult" class="result"></div>
        </div>

        <div class="step">
            <h3>üõ†Ô∏è 2. Criar usu√°rio no Supabase Auth</h3>
            <button onclick="createAuthUser()">Criar Usu√°rio Auth</button>
            <div id="authResult" class="result"></div>
        </div>

        <div class="step">
            <h3>üìä 3. Adicionar na tabela habbo_accounts</h3>
            <button onclick="addToHabboAccounts()">Adicionar em habbo_accounts</button>
            <div id="habboResult" class="result"></div>
        </div>

        <div class="step">
            <h3>üë§ 4. Adicionar na tabela users (se necess√°rio)</h3>
            <button onclick="addToUsers()">Adicionar em users</button>
            <div id="usersResult" class="result"></div>
        </div>

        <div class="step">
            <h3>‚úÖ 5. Testar login</h3>
            <button onclick="testLogin()">Testar Login</button>
            <div id="testResult" class="result"></div>
        </div>

        <div class="step">
            <h3>üîß 6. Executar SQL direto (se necess√°rio)</h3>
            <button onclick="executeDirectSQL()">Executar SQL</button>
            <div id="sqlResult" class="result"></div>
        </div>
    </div>

    <script>
        // Suas chaves do Supabase
        const SUPABASE_URL = 'https://wueccgeizznjmjgmuscy.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Ind1ZWNnZ2VpenpqbWpnbXVzY3kiLCJyb2xlIjoiYW5vbiIsImlhdCI6MTczNTQ2NzQ0MCwiZXhwIjoyMDUxMDQzNDQwfQ.8J8J8J8J8J8J8J8J8J8J8J8J8J8J8J8J8J8J8J8J8';
        const SUPABASE_SERVICE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Ind1ZWNnZ2VpenpqbWpnbXVzY3kiLCJyb2xlIjoic2VydmljZV9yb2xlIiwiaWF0IjoxNzM1NDY3NDQwLCJleHAiOjIwNTEwNDM0NDB9.8J8J8J8J8J8J8J8J8J8J8J8J8J8J8J8J8J8J8J8J8';

        let createdUserId = null;

        async function checkExistingAccounts() {
            const resultDiv = document.getElementById('checkResult');
            resultDiv.innerHTML = 'üîç Verificando contas existentes...';
            
            try {
                // Verificar habbo_accounts
                const habboResponse = await fetch(`${SUPABASE_URL}/rest/v1/habbo_accounts?select=*&habbo_name=eq.habbohub&hotel=eq.br`, {
                    headers: {
                        'apikey': SUPABASE_SERVICE_KEY,
                        'Authorization': `Bearer ${SUPABASE_SERVICE_KEY}`,
                        'Content-Type': 'application/json'
                    }
                });

                // Verificar users
                const usersResponse = await fetch(`${SUPABASE_URL}/rest/v1/users?select=*&habbo_username=eq.habbohub`, {
                    headers: {
                        'apikey': SUPABASE_SERVICE_KEY,
                        'Authorization': `Bearer ${SUPABASE_SERVICE_KEY}`,
                        'Content-Type': 'application/json'
                    }
                });

                let result = 'üìä Status das contas:\n\n';
                
                if (habboResponse.ok) {
                    const habboData = await habboResponse.json();
                    result += `habbo_accounts: ${habboData.length > 0 ? '‚úÖ Encontrada' : '‚ùå N√£o encontrada'}\n`;
                    if (habboData.length > 0) {
                        result += `  ID: ${habboData[0].id}\n`;
                        result += `  Supabase User ID: ${habboData[0].supabase_user_id}\n`;
                    }
                } else {
                    result += `habbo_accounts: ‚ùå Erro ${habboResponse.status}\n`;
                }

                if (usersResponse.ok) {
                    const usersData = await usersResponse.json();
                    result += `users: ${usersData.length > 0 ? '‚úÖ Encontrada' : '‚ùå N√£o encontrada'}\n`;
                    if (usersData.length > 0) {
                        result += `  ID: ${usersData[0].id}\n`;
                    }
                } else {
                    result += `users: ‚ùå Erro ${usersResponse.status}\n`;
                }

                resultDiv.innerHTML = result;
                resultDiv.className = 'result info';
            } catch (error) {
                resultDiv.innerHTML = `‚ùå Erro: ${error.message}`;
                resultDiv.className = 'result error';
            }
        }

        async function createAuthUser() {
            const resultDiv = document.getElementById('authResult');
            resultDiv.innerHTML = 'üõ†Ô∏è Criando usu√°rio no Supabase Auth...';
            
            try {
                const response = await fetch(`${SUPABASE_URL}/auth/v1/admin/users`, {
                    method: 'POST',
                    headers: {
                        'apikey': SUPABASE_SERVICE_KEY,
                        'Authorization': `Bearer ${SUPABASE_SERVICE_KEY}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        email: 'habbohub@habbohub.com',
                        password: '151092',
                        email_confirm: true,
                        user_metadata: {
                            habbo_name: 'habbohub',
                            hotel: 'br'
                        }
                    })
                });

                if (response.ok) {
                    const data = await response.json();
                    createdUserId = data.user.id;
                    resultDiv.innerHTML = `‚úÖ Usu√°rio Auth criado com sucesso!\n\nID: ${createdUserId}\nEmail: ${data.user.email}`;
                    resultDiv.className = 'result success';
                } else {
                    const errorText = await response.text();
                    resultDiv.innerHTML = `‚ùå Erro ao criar usu√°rio Auth: ${response.status} - ${errorText}`;
                    resultDiv.className = 'result error';
                }
            } catch (error) {
                resultDiv.innerHTML = `‚ùå Erro: ${error.message}`;
                resultDiv.className = 'result error';
            }
        }

        async function addToHabboAccounts() {
            const resultDiv = document.getElementById('habboResult');
            resultDiv.innerHTML = 'üìä Adicionando na tabela habbo_accounts...';
            
            if (!createdUserId) {
                resultDiv.innerHTML = '‚ùå Primeiro crie o usu√°rio Auth';
                resultDiv.className = 'result error';
                return;
            }

            try {
                const accountData = {
                    supabase_user_id: createdUserId,
                    habbo_name: 'habbohub',
                    habbo_id: '1',
                    hotel: 'br',
                    is_admin: true,
                    motto: 'HUB-ADMIN',
                    figure_string: 'hd-180-1.ch-255-66.lg-285-91.sh-290-62.ha-1012-110.hr-831-49.wa-2001-62',
                    is_online: false
                };

                const response = await fetch(`${SUPABASE_URL}/rest/v1/habbo_accounts`, {
                    method: 'POST',
                    headers: {
                        'apikey': SUPABASE_SERVICE_KEY,
                        'Authorization': `Bearer ${SUPABASE_SERVICE_KEY}`,
                        'Content-Type': 'application/json',
                        'Prefer': 'return=minimal'
                    },
                    body: JSON.stringify(accountData)
                });

                if (response.ok) {
                    resultDiv.innerHTML = `‚úÖ Conta adicionada em habbo_accounts!\n\nDados:\n${JSON.stringify(accountData, null, 2)}`;
                    resultDiv.className = 'result success';
                } else {
                    const errorText = await response.text();
                    resultDiv.innerHTML = `‚ùå Erro: ${response.status} - ${errorText}`;
                    resultDiv.className = 'result error';
                }
            } catch (error) {
                resultDiv.innerHTML = `‚ùå Erro: ${error.message}`;
                resultDiv.className = 'result error';
            }
        }

        async function addToUsers() {
            const resultDiv = document.getElementById('usersResult');
            resultDiv.innerHTML = 'üë§ Adicionando na tabela users...';
            
            try {
                // Hash da senha (simplificado para teste)
                const passwordHash = btoa('151092'); // Base64 encoding simples

                const userData = {
                    habbo_username: 'habbohub',
                    habbo_motto: 'HUB-ADMIN',
                    password_hash: passwordHash,
                    is_admin: true,
                    is_verified: true
                };

                const response = await fetch(`${SUPABASE_URL}/rest/v1/users`, {
                    method: 'POST',
                    headers: {
                        'apikey': SUPABASE_SERVICE_KEY,
                        'Authorization': `Bearer ${SUPABASE_SERVICE_KEY}`,
                        'Content-Type': 'application/json',
                        'Prefer': 'return=minimal'
                    },
                    body: JSON.stringify(userData)
                });

                if (response.ok) {
                    resultDiv.innerHTML = `‚úÖ Usu√°rio adicionado em users!\n\nDados:\n${JSON.stringify(userData, null, 2)}`;
                    resultDiv.className = 'result success';
                } else {
                    const errorText = await response.text();
                    resultDiv.innerHTML = `‚ùå Erro: ${response.status} - ${errorText}`;
                    resultDiv.className = 'result error';
                }
            } catch (error) {
                resultDiv.innerHTML = `‚ùå Erro: ${error.message}`;
                resultDiv.className = 'result error';
            }
        }

        async function testLogin() {
            const resultDiv = document.getElementById('testResult');
            resultDiv.innerHTML = '‚úÖ Testando login habbohub...';
            
            try {
                const response = await fetch(`${SUPABASE_URL}/rest/v1/habbo_accounts?select=*&habbo_name=eq.habbohub&hotel=eq.br`, {
                    headers: {
                        'apikey': SUPABASE_ANON_KEY,
                        'Authorization': `Bearer ${SUPABASE_ANON_KEY}`,
                        'Content-Type': 'application/json'
                    }
                });

                if (response.ok) {
                    const data = await response.json();
                    if (data.length > 0) {
                        resultDiv.innerHTML = `‚úÖ Login testado com sucesso!\n\nConta encontrada:\n${JSON.stringify(data[0], null, 2)}`;
                        resultDiv.className = 'result success';
                    } else {
                        resultDiv.innerHTML = '‚ùå Conta n√£o encontrada no teste.';
                        resultDiv.className = 'result error';
                    }
                } else {
                    resultDiv.innerHTML = `‚ùå Erro no teste: ${response.status} ${response.statusText}`;
                    resultDiv.className = 'result error';
                }
            } catch (error) {
                resultDiv.innerHTML = `‚ùå Erro no teste: ${error.message}`;
                resultDiv.className = 'result error';
            }
        }

        async function executeDirectSQL() {
            const resultDiv = document.getElementById('sqlResult');
            resultDiv.innerHTML = 'üîß Executando SQL direto...';
            
            try {
                // SQL para inserir diretamente
                const sql = `
-- Inserir usu√°rio na tabela users
INSERT INTO public.users (habbo_username, habbo_motto, password_hash, is_admin, is_verified) 
VALUES ('habbohub', 'HUB-ADMIN', 'MTUxMDky', true, true)
ON CONFLICT (habbo_username) DO UPDATE SET
  habbo_motto = EXCLUDED.habbo_motto,
  password_hash = EXCLUDED.password_hash,
  is_admin = EXCLUDED.is_admin,
  is_verified = EXCLUDED.is_verified,
  updated_at = NOW();

-- Inserir conta na tabela habbo_accounts (precisa de um supabase_user_id v√°lido)
-- Este comando pode falhar se n√£o houver um usu√°rio Auth correspondente
INSERT INTO public.habbo_accounts (supabase_user_id, habbo_name, habbo_id, hotel, is_admin, motto, figure_string, is_online)
VALUES (
  (SELECT id FROM auth.users WHERE email = 'habbohub@habbohub.com' LIMIT 1),
  'habbohub', 
  '1', 
  'br', 
  true, 
  'HUB-ADMIN', 
  'hd-180-1.ch-255-66.lg-285-91.sh-290-62.ha-1012-110.hr-831-49.wa-2001-62',
  false
)
ON CONFLICT (habbo_name, hotel) DO UPDATE SET
  is_admin = EXCLUDED.is_admin,
  motto = EXCLUDED.motto,
  figure_string = EXCLUDED.figure_string,
  updated_at = NOW();
                `;

                const response = await fetch(`${SUPABASE_URL}/rest/v1/rpc/exec_sql`, {
                    method: 'POST',
                    headers: {
                        'apikey': SUPABASE_SERVICE_KEY,
                        'Authorization': `Bearer ${SUPABASE_SERVICE_KEY}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ sql: sql })
                });

                if (response.ok) {
                    resultDiv.innerHTML = `‚úÖ SQL executado com sucesso!\n\nSQL:\n${sql}`;
                    resultDiv.className = 'result success';
                } else {
                    const errorText = await response.text();
                    resultDiv.innerHTML = `‚ùå Erro ao executar SQL: ${response.status} - ${errorText}\n\nSQL:\n${sql}`;
                    resultDiv.className = 'result error';
                }
            } catch (error) {
                resultDiv.innerHTML = `‚ùå Erro: ${error.message}`;
                resultDiv.className = 'result error';
            }
        }
    </script>
</body>
</html>
