<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste Completo do Sistema de Handitems</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; }
        .container { max-width: 1400px; margin: 0 auto; }
        .section { background: white; margin: 20px 0; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .handitem-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 15px; margin-top: 15px; }
        .handitem-card { border: 1px solid #ddd; padding: 10px; border-radius: 8px; text-align: center; background: #fafafa; }
        .handitem-card img { width: 60px; height: 60px; margin-bottom: 10px; border: 1px solid #ccc; }
        .handitem-card h4 { margin: 5px 0; font-size: 14px; }
        .handitem-card p { margin: 2px 0; font-size: 12px; color: #666; }
        .status { padding: 8px 12px; border-radius: 4px; font-weight: bold; margin: 5px 0; }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .loading { background: #fff3cd; color: #856404; }
        .info { background: #d1ecf1; color: #0c5460; }
        button { padding: 10px 20px; margin: 5px; background: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer; }
        button:hover { background: #0056b3; }
        button:disabled { background: #6c757d; cursor: not-allowed; }
        .avatar-preview { display: flex; gap: 20px; align-items: center; margin: 20px 0; }
        .avatar-preview img { width: 100px; height: 120px; border: 2px solid #ddd; border-radius: 8px; }
        .stats { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin: 20px 0; }
        .stat-card { background: #f8f9fa; padding: 15px; border-radius: 8px; text-align: center; }
        .stat-number { font-size: 24px; font-weight: bold; color: #007bff; }
        .stat-label { font-size: 14px; color: #666; margin-top: 5px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîç Teste Completo do Sistema de Handitems</h1>
        <p>Sistema de descoberta autom√°tica e preview de avatar para handitems do Habbo</p>
        
        <div class="section">
            <h2>üìä Estat√≠sticas do Sistema</h2>
            <div class="stats">
                <div class="stat-card">
                    <div class="stat-number" id="totalHanditems">0</div>
                    <div class="stat-label">Handitems Descobertos</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="workingImages">0</div>
                    <div class="stat-label">Imagens Funcionais</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="avatarTests">0</div>
                    <div class="stat-label">Testes de Avatar</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="successRate">0%</div>
                    <div class="stat-label">Taxa de Sucesso</div>
                </div>
            </div>
        </div>
        
        <div class="section">
            <h2>üîç Descoberta Autom√°tica de Handitems</h2>
            <div>
                <button onclick="startDiscovery()" id="discoverBtn">Iniciar Descoberta Autom√°tica</button>
                <button onclick="testSpecificRange()" id="specificBtn">Testar Range Espec√≠fico (176-180)</button>
                <button onclick="clearResults()">Limpar Resultados</button>
            </div>
            <div id="discoveryStatus"></div>
            <div id="discoveryResults" class="handitem-grid"></div>
        </div>
        
        <div class="section">
            <h2>üë§ Preview de Avatar</h2>
            <div>
                <input type="text" id="habboName" placeholder="Nome do Habbo" value="Habbo" style="padding: 8px; margin: 5px; border: 1px solid #ddd; border-radius: 4px;">
                <button onclick="testAvatarPreview()" id="avatarBtn">Testar Preview de Avatar</button>
            </div>
            <div id="avatarStatus"></div>
            <div id="avatarResults" class="avatar-preview"></div>
        </div>
        
        <div class="section">
            <h2>üß™ Teste de Handitems Espec√≠ficos</h2>
            <div>
                <button onclick="testKnownHanditems()" id="knownBtn">Testar Handitems Conhecidos</button>
                <button onclick="testNewHanditems()" id="newBtn">Testar Novos Handitems</button>
            </div>
            <div id="testStatus"></div>
            <div id="testResults" class="handitem-grid"></div>
        </div>
    </div>

    <script>
        let discoveredHanditems = [];
        let testResults = {
            total: 0,
            working: 0,
            avatarTests: 0
        };
        
        async function startDiscovery() {
            const btn = document.getElementById('discoverBtn');
            const status = document.getElementById('discoveryStatus');
            const results = document.getElementById('discoveryResults');
            
            btn.disabled = true;
            btn.textContent = 'Descobrindo...';
            status.innerHTML = '<div class="loading">üîç Iniciando descoberta autom√°tica de handitems...</div>';
            results.innerHTML = '';
            
            try {
                const discovered = await discoverHanditems(170, 200);
                discoveredHanditems = discovered;
                
                status.innerHTML = `<div class="success">‚úÖ Descoberta conclu√≠da! ${discovered.length} handitems encontrados</div>`;
                
                results.innerHTML = discovered.map(item => `
                    <div class="handitem-card">
                        <h4>Handitem ${item.id}</h4>
                        <p>Varia√ß√µes: ${item.images.length}/4</p>
                        <div>
                            ${item.images.map(img => `
                                <img src="${img.url}" alt="Varia√ß√£o ${img.variation}" title="Varia√ß√£o ${img.variation}" style="width: 30px; height: 30px; margin: 2px;">
                            `).join('')}
                        </div>
                        <p><small>Descoberto: ${new Date(item.discovered).toLocaleString()}</small></p>
                    </div>
                `).join('');
                
                updateStats();
                
            } catch (error) {
                status.innerHTML = `<div class="error">‚ùå Erro na descoberta: ${error.message}</div>`;
            } finally {
                btn.disabled = false;
                btn.textContent = 'Iniciar Descoberta Autom√°tica';
            }
        }
        
        async function testSpecificRange() {
            const btn = document.getElementById('specificBtn');
            const status = document.getElementById('discoveryStatus');
            const results = document.getElementById('discoveryResults');
            
            btn.disabled = true;
            btn.textContent = 'Testando...';
            status.innerHTML = '<div class="loading">üîç Testando range espec√≠fico (176-180)...</div>';
            results.innerHTML = '';
            
            try {
                const discovered = await discoverHanditems(176, 180);
                
                status.innerHTML = `<div class="success">‚úÖ Teste conclu√≠do! ${discovered.length} handitems encontrados no range 176-180</div>`;
                
                results.innerHTML = discovered.map(item => `
                    <div class="handitem-card">
                        <h4>Handitem ${item.id}</h4>
                        <p>Varia√ß√µes: ${item.images.length}/4</p>
                        <div>
                            ${item.images.map(img => `
                                <img src="${img.url}" alt="Varia√ß√£o ${img.variation}" title="Varia√ß√£o ${img.variation}" style="width: 30px; height: 30px; margin: 2px;">
                            `).join('')}
                        </div>
                    </div>
                `).join('');
                
            } catch (error) {
                status.innerHTML = `<div class="error">‚ùå Erro no teste: ${error.message}</div>`;
            } finally {
                btn.disabled = false;
                btn.textContent = 'Testar Range Espec√≠fico (176-180)';
            }
        }
        
        async function testAvatarPreview() {
            const btn = document.getElementById('avatarBtn');
            const status = document.getElementById('avatarStatus');
            const results = document.getElementById('avatarResults');
            const habboName = document.getElementById('habboName').value || 'Habbo';
            
            btn.disabled = true;
            btn.textContent = 'Testando...';
            status.innerHTML = '<div class="loading">üîç Testando preview de avatar...</div>';
            results.innerHTML = '';
            
            try {
                const testHanditems = [1, 2, 3, 25, 30, 176, 177];
                const avatarResults = [];
                
                for (const handitemId of testHanditems) {
                    const avatarUrl = generateAvatarUrl(habboName, handitemId);
                    const isValid = await testAvatarUrl(avatarUrl);
                    
                    if (isValid) {
                        avatarResults.push({ handitemId, avatarUrl, valid: true });
                        testResults.avatarTests++;
                    }
                }
                
                status.innerHTML = `<div class="success">‚úÖ Preview testado! ${avatarResults.length}/${testHanditems.length} handitems funcionam com avatar</div>`;
                
                results.innerHTML = avatarResults.map(item => `
                    <div>
                        <h4>Handitem ${item.handitemId}</h4>
                        <img src="${item.avatarUrl}" alt="Avatar com handitem ${item.handitemId}">
                    </div>
                `).join('');
                
                updateStats();
                
            } catch (error) {
                status.innerHTML = `<div class="error">‚ùå Erro no teste de avatar: ${error.message}</div>`;
            } finally {
                btn.disabled = false;
                btn.textContent = 'Testar Preview de Avatar';
            }
        }
        
        async function testKnownHanditems() {
            const btn = document.getElementById('knownBtn');
            const status = document.getElementById('testStatus');
            const results = document.getElementById('testResults');
            
            btn.disabled = true;
            btn.textContent = 'Testando...';
            status.innerHTML = '<div class="loading">üîç Testando handitems conhecidos...</div>';
            results.innerHTML = '';
            
            const knownHanditems = [
                { id: 1, name: "Ch√°", expectedUrl: "https://images.habbotemplarios.com/web/avatargen/hand_japanesetea.png" },
                { id: 2, name: "Suco", expectedUrl: "https://images.habbotemplarios.com/web/avatargen/hand_water.png" },
                { id: 3, name: "Cenoura", expectedUrl: "https://images.habbotemplarios.com/web/avatargen/hand_carrot.png" },
                { id: 25, name: "Po√ß√£o do Amor", expectedUrl: "https://images.habbotemplarios.com/web/avatargen/hand_lovepotion.png" },
                { id: 30, name: "L√≠quido Radioativo", expectedUrl: "https://images.habbotemplarios.com/web/avatargen/hand_radioactive.png" }
            ];
            
            try {
                const testResults_data = [];
                
                for (const item of knownHanditems) {
                    const exists = await imageExists(item.expectedUrl);
                    testResults_data.push({ ...item, exists });
                    testResults.total++;
                    if (exists) testResults.working++;
                }
                
                status.innerHTML = `<div class="success">‚úÖ Teste conclu√≠do! ${testResults_data.filter(r => r.exists).length}/${testResults_data.length} handitems conhecidos funcionam</div>`;
                
                results.innerHTML = testResults_data.map(item => `
                    <div class="handitem-card">
                        <h4>${item.name}</h4>
                        <p>ID: ${item.id}</p>
                        <img src="${item.expectedUrl}" alt="${item.name}" onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjAiIGhlaWdodD0iNjAiIHZpZXdCb3g9IjAgMCA2MCA2MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjYwIiBoZWlnaHQ9IjYwIiBmaWxsPSIjZjBmMGYwIi8+Cjx0ZXh0IHg9IjMwIiB5PSIzMCIgZm9udC1mYW1pbHk9IkFyaWFsIiBmb250LXNpemU9IjE0IiBmaWxsPSIjOTk5IiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBkeT0iLjNlbSI+PDw8L3RleHQ+Cjwvc3ZnPg=='">
                        <p class="status ${item.exists ? 'success' : 'error'}">${item.exists ? '‚úÖ Funciona' : '‚ùå N√£o encontrado'}</p>
                    </div>
                `).join('');
                
                updateStats();
                
            } catch (error) {
                status.innerHTML = `<div class="error">‚ùå Erro no teste: ${error.message}</div>`;
            } finally {
                btn.disabled = false;
                btn.textContent = 'Testar Handitems Conhecidos';
            }
        }
        
        async function testNewHanditems() {
            const btn = document.getElementById('newBtn');
            const status = document.getElementById('testStatus');
            const results = document.getElementById('testResults');
            
            btn.disabled = true;
            btn.textContent = 'Testando...';
            status.innerHTML = '<div class="loading">üîç Testando novos handitems...</div>';
            results.innerHTML = '';
            
            try {
                const newHanditems = [176, 177, 178, 179, 180];
                const testResults_data = [];
                
                for (const id of newHanditems) {
                    const variations = await getHanditemVariations(id);
                    testResults_data.push({ id, variations });
                    testResults.total++;
                    if (variations.length > 0) testResults.working++;
                }
                
                status.innerHTML = `<div class="success">‚úÖ Teste conclu√≠do! ${testResults_data.filter(r => r.variations.length > 0).length}/${testResults_data.length} novos handitems encontrados</div>`;
                
                results.innerHTML = testResults_data.map(item => `
                    <div class="handitem-card">
                        <h4>Handitem ${item.id}</h4>
                        <p>Varia√ß√µes: ${item.variations.length}/4</p>
                        <div>
                            ${item.variations.map(v => `
                                <img src="${v.url}" alt="Varia√ß√£o ${v.variation}" title="Varia√ß√£o ${v.variation}" style="width: 30px; height: 30px; margin: 2px;">
                            `).join('')}
                        </div>
                        <p class="status ${item.variations.length > 0 ? 'success' : 'error'}">${item.variations.length > 0 ? '‚úÖ Encontrado' : '‚ùå N√£o encontrado'}</p>
                    </div>
                `).join('');
                
                updateStats();
                
            } catch (error) {
                status.innerHTML = `<div class="error">‚ùå Erro no teste: ${error.message}</div>`;
            } finally {
                btn.disabled = false;
                btn.textContent = 'Testar Novos Handitems';
            }
        }
        
        async function discoverHanditems(startId, endId) {
            const discovered = [];
            const currentYear = new Date().getFullYear();
            const currentMonth = String(new Date().getMonth() + 1).padStart(2, '0');
            const baseUrl = `https://images.habbotemplarios.com/${currentYear}/${currentMonth}/handitem`;
            
            for (let id = startId; id <= endId; id++) {
                const variations = [0, 1, 2, 3];
                const images = [];
                
                for (const variation of variations) {
                    const url = `${baseUrl}${id}_${variation}.png`;
                    if (await imageExists(url)) {
                        images.push({ variation, url });
                    }
                }
                
                if (images.length > 0) {
                    discovered.push({
                        id,
                        images,
                        discovered: new Date().toISOString()
                    });
                }
            }
            
            return discovered;
        }
        
        async function getHanditemVariations(id) {
            const currentYear = new Date().getFullYear();
            const currentMonth = String(new Date().getMonth() + 1).padStart(2, '0');
            const baseUrl = `https://images.habbotemplarios.com/${currentYear}/${currentMonth}/handitem`;
            const variations = [0, 1, 2, 3];
            const images = [];
            
            for (const variation of variations) {
                const url = `${baseUrl}${id}_${variation}.png`;
                if (await imageExists(url)) {
                    images.push({ variation, url });
                }
            }
            
            return images;
        }
        
        function generateAvatarUrl(habboName, handitemId, size = 'l') {
            const baseUrl = 'https://www.habbo.com.br/habbo-imaging/avatarimage';
            const params = new URLSearchParams({
                user: habboName,
                action: handitemId ? `,crr=${handitemId}` : 'none',
                direction: '2',
                head_direction: '2',
                gesture: 'nrm',
                size: size
            });
            return `${baseUrl}?${params.toString()}`;
        }
        
        async function testAvatarUrl(url) {
            try {
                const response = await fetch(url);
                return response.ok;
            } catch {
                return false;
            }
        }
        
        async function imageExists(url) {
            try {
                const response = await fetch(url, { method: 'HEAD' });
                return response.ok;
            } catch {
                return false;
            }
        }
        
        function updateStats() {
            document.getElementById('totalHanditems').textContent = testResults.total;
            document.getElementById('workingImages').textContent = testResults.working;
            document.getElementById('avatarTests').textContent = testResults.avatarTests;
            document.getElementById('successRate').textContent = testResults.total > 0 ? Math.round((testResults.working / testResults.total) * 100) + '%' : '0%';
        }
        
        function clearResults() {
            document.getElementById('discoveryResults').innerHTML = '';
            document.getElementById('avatarResults').innerHTML = '';
            document.getElementById('testResults').innerHTML = '';
            document.getElementById('discoveryStatus').innerHTML = '';
            document.getElementById('avatarStatus').innerHTML = '';
            document.getElementById('testStatus').innerHTML = '';
        }
    </script>
</body>
</html>
