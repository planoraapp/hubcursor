<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste - An√°lise Visual de G√™nero Habbo</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .analysis-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        .analysis-item {
            border: 2px solid #ddd;
            border-radius: 8px;
            padding: 10px;
            text-align: center;
            background: white;
            transition: all 0.3s;
        }
        .analysis-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        .item-image {
            width: 120px;
            height: 120px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background-size: cover;
            background-position: center;
            margin: 0 auto 10px;
            position: relative;
        }
        .gender-badge {
            position: absolute;
            top: 5px;
            right: 5px;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 11px;
            color: white;
            font-weight: bold;
            text-shadow: 1px 1px 1px rgba(0,0,0,0.5);
        }
        .male { background: #007bff; }
        .female { background: #e91e63; }
        .unknown { background: #ff9800; }
        .item-info {
            font-size: 12px;
            margin: 5px 0;
        }
        .item-id {
            font-weight: bold;
            color: #333;
        }
        .detection-method {
            font-size: 10px;
            color: #666;
            font-style: italic;
        }
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            margin: 8px;
            background: #007bff;
            color: white;
            font-weight: bold;
            transition: all 0.3s;
        }
        .btn:hover {
            background: #0056b3;
            transform: translateY(-1px);
        }
        .btn-success { background: #28a745; }
        .btn-warning { background: #ffc107; color: black; }
        .btn-danger { background: #dc3545; }
        .btn-info { background: #17a2b8; }
        .results {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
            font-family: monospace;
            max-height: 300px;
            overflow-y: auto;
        }
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        .stat-number {
            font-size: 2.5em;
            font-weight: bold;
            margin-bottom: 5px;
        }
        .progress-bar {
            width: 100%;
            height: 20px;
            background: #e9ecef;
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #28a745, #20c997);
            transition: width 0.3s ease;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üî¨ Teste - An√°lise Visual de G√™nero Habbo</h1>
        <p>Este sistema analisa visualmente as imagens para detectar diferen√ßas entre corpos masculinos e femininos.</p>
        
        <!-- Estat√≠sticas -->
        <div class="stats">
            <div class="stat-card">
                <div class="stat-number" id="totalAnalyzed">0</div>
                <div>Total Analisado</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="maleCount">0</div>
                <div>Masculino</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="femaleCount">0</div>
                <div>Feminino</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="accuracy">0%</div>
                <div>Precis√£o</div>
            </div>
        </div>
        
        <!-- Controles -->
        <div class="test-section">
            <h3>üéÆ Controles de Teste</h3>
            <button class="btn btn-success" id="testBodies">üßç Testar Corpos (An√°lise Visual)</button>
            <button class="btn btn-info" id="testQuick">‚ö° Teste R√°pido (Baseado em ID)</button>
            <button class="btn btn-warning" id="clearCache">üóëÔ∏è Limpar Cache</button>
            <button class="btn btn-danger" id="clearResults">üîÑ Limpar Resultados</button>
        </div>
        
        <!-- Barra de Progresso -->
        <div class="test-section">
            <h3>üìä Progresso da An√°lise</h3>
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill" style="width: 0%"></div>
            </div>
            <div id="progressText">Aguardando in√≠cio dos testes...</div>
        </div>
        
        <!-- Resultados -->
        <div class="results" id="results">
            Sistema de an√°lise visual inicializado. Clique em um bot√£o para come√ßar os testes...
        </div>
        
        <!-- Teste de Corpos com An√°lise Visual -->
        <div class="test-section">
            <h3>üîç An√°lise Visual de Corpos</h3>
            <p>Analisando caracter√≠sticas visuais para detectar diferen√ßas de g√™nero</p>
            <div class="analysis-grid" id="analysisGrid">
                <!-- Resultados da an√°lise ser√£o exibidos aqui -->
            </div>
        </div>
    </div>
    
    <script src="smart-gender-detection.js"></script>
    <script>
        class VisualAnalysisTester {
            constructor() {
                this.initializeEventListeners();
                this.analysisResults = [];
                this.isAnalyzing = false;
            }
            
            initializeEventListeners() {
                document.getElementById('testBodies').addEventListener('click', () => this.testBodiesWithVisualAnalysis());
                document.getElementById('testQuick').addEventListener('click', () => this.testQuickDetection());
                document.getElementById('clearCache').addEventListener('click', () => this.clearCache());
                document.getElementById('clearResults').addEventListener('click', () => this.clearResults());
            }
            
            async testBodiesWithVisualAnalysis() {
                if (this.isAnalyzing) {
                    this.log('‚ö†Ô∏è An√°lise j√° em andamento...');
                    return;
                }
                
                this.isAnalyzing = true;
                this.log('üî¨ Iniciando an√°lise visual de corpos...');
                
                const grid = document.getElementById('analysisGrid');
                grid.innerHTML = '';
                
                // Corpos para testar
                const testBodies = [
                    // Corpos masculinos conhecidos
                    { id: '1', expected: 'M' },
                    { id: '10', expected: 'M' },
                    { id: '50', expected: 'M' },
                    { id: '100', expected: 'M' },
                    { id: '150', expected: 'M' },
                    { id: '199', expected: 'M' },
                    
                    // Corpos femininos conhecidos
                    { id: '210', expected: 'F' },
                    { id: '220', expected: 'F' },
                    { id: '230', expected: 'F' },
                    { id: '240', expected: 'F' },
                    { id: '250', expected: 'F' },
                    { id: '260', expected: 'F' },
                    
                    // Corpos especiais para teste
                    { id: '300', expected: 'F' },
                    { id: '400', expected: 'F' },
                    { id: '500', expected: 'F' },
                    { id: '600', expected: 'F' },
                    { id: '700', expected: 'F' },
                    { id: '800', expected: 'F' }
                ];
                
                let analyzed = 0;
                const total = testBodies.length;
                
                for (const body of testBodies) {
                    try {
                        this.log(`üîç Analisando corpo ${body.id}...`);
                        
                        // Gerar URL da imagem
                        const imageUrl = `https://www.habbo.com/habbo-imaging/avatarimage?figure=ch-${body.id}-1-&gender=M&size=m`;
                        
                        // An√°lise visual
                        const detectedGender = await smartDetectGender(body.id, 'ch', imageUrl);
                        
                        // Criar item de resultado
                        const resultItem = this.createAnalysisItem(body.id, 'ch', detectedGender, body.expected, imageUrl);
                        grid.appendChild(resultItem);
                        
                        // Atualizar estat√≠sticas
                        this.analysisResults.push({
                            id: body.id,
                            type: 'ch',
                            detected: detectedGender,
                            expected: body.expected,
                            correct: detectedGender === body.expected
                        });
                        
                        analyzed++;
                        this.updateProgress(analyzed, total);
                        this.updateStats();
                        
                        // Pequena pausa para n√£o sobrecarregar
                        await new Promise(resolve => setTimeout(resolve, 200));
                        
                    } catch (error) {
                        this.log(`‚ùå Erro ao analisar corpo ${body.id}: ${error.message}`);
                        analyzed++;
                        this.updateProgress(analyzed, total);
                    }
                }
                
                this.isAnalyzing = false;
                this.log(`‚úÖ An√°lise visual conclu√≠da! ${analyzed} corpos analisados.`);
                this.showFinalResults();
            }
            
            testQuickDetection() {
                this.log('‚ö° Iniciando teste r√°pido baseado em ID...');
                
                const grid = document.getElementById('analysisGrid');
                grid.innerHTML = '';
                
                const testBodies = [
                    { id: '1', expected: 'M' },
                    { id: '50', expected: 'M' },
                    { id: '100', expected: 'M' },
                    { id: '150', expected: 'M' },
                    { id: '210', expected: 'F' },
                    { id: '250', expected: 'F' },
                    { id: '300', expected: 'F' },
                    { id: '400', expected: 'F' }
                ];
                
                testBodies.forEach(body => {
                    const detectedGender = quickDetectGender(body.id, 'ch');
                    const imageUrl = `https://www.habbo.com/habbo-imaging/avatarimage?figure=ch-${body.id}-1-&gender=${detectedGender}&size=m`;
                    
                    const resultItem = this.createAnalysisItem(body.id, 'ch', detectedGender, body.expected, imageUrl, 'ID');
                    grid.appendChild(resultItem);
                    
                    this.analysisResults.push({
                        id: body.id,
                        type: 'ch',
                        detected: detectedGender,
                        expected: body.expected,
                        correct: detectedGender === body.expected
                    });
                });
                
                this.updateStats();
                this.log('‚úÖ Teste r√°pido conclu√≠do!');
            }
            
            createAnalysisItem(itemId, itemType, detectedGender, expectedGender, imageUrl, method = 'Visual') {
                const item = document.createElement('div');
                item.className = 'analysis-item';
                
                const isCorrect = detectedGender === expectedGender;
                const borderColor = isCorrect ? '#28a745' : '#dc3545';
                item.style.borderColor = borderColor;
                
                item.innerHTML = `
                    <div class="item-image" style="background-image: url('${imageUrl}')">
                        <div class="gender-badge ${detectedGender === 'M' ? 'male' : 'female'}">
                            ${detectedGender}
                        </div>
                    </div>
                    <div class="item-info">
                        <div class="item-id">${itemType.toUpperCase()} ${itemId}</div>
                        <div>Detectado: <strong>${detectedGender}</strong></div>
                        <div>Esperado: <strong>${expectedGender}</strong></div>
                        <div style="color: ${isCorrect ? '#28a745' : '#dc3545'}; font-weight: bold;">
                            ${isCorrect ? '‚úÖ Correto' : '‚ùå Incorreto'}
                        </div>
                        <div class="detection-method">M√©todo: ${method}</div>
                    </div>
                `;
                
                // Evento de clique para detalhes
                item.addEventListener('click', () => {
                    this.showItemDetails(itemId, itemType, detectedGender, imageUrl);
                });
                
                return item;
            }
            
            showItemDetails(itemId, itemType, detectedGender, imageUrl) {
                const details = `
                    üìã Detalhes da An√°lise:
                    - Item: ${itemType.toUpperCase()} ${itemId}
                    - G√™nero Detectado: ${detectedGender}
                    - URL da Imagem: ${imageUrl}
                    - M√©todo: An√°lise Visual + Fallback
                `;
                
                this.log(details);
                
                // Abrir em nova aba para verifica√ß√£o
                window.open(imageUrl, '_blank');
            }
            
            updateProgress(current, total) {
                const percentage = Math.round((current / total) * 100);
                document.getElementById('progressFill').style.width = percentage + '%';
                document.getElementById('progressText').textContent = `Analisando... ${current}/${total} (${percentage}%)`;
            }
            
            updateStats() {
                const total = this.analysisResults.length;
                const male = this.analysisResults.filter(r => r.detected === 'M').length;
                const female = this.analysisResults.filter(r => r.detected === 'F').length;
                const correct = this.analysisResults.filter(r => r.correct).length;
                const accuracy = total > 0 ? Math.round((correct / total) * 100) : 0;
                
                document.getElementById('totalAnalyzed').textContent = total;
                document.getElementById('maleCount').textContent = male;
                document.getElementById('femaleCount').textContent = female;
                document.getElementById('accuracy').textContent = accuracy + '%';
            }
            
            showFinalResults() {
                const total = this.analysisResults.length;
                const correct = this.analysisResults.filter(r => r.correct).length;
                const accuracy = Math.round((correct / total) * 100);
                
                this.log(`
                    üéØ RESULTADOS FINAIS:
                    - Total analisado: ${total}
                    - Corretos: ${correct}
                    - Incorretos: ${total - correct}
                    - Precis√£o: ${accuracy}%
                    
                    ${accuracy >= 80 ? 'üéâ Excelente precis√£o!' : accuracy >= 60 ? 'üëç Boa precis√£o!' : '‚ö†Ô∏è Precis√£o pode ser melhorada'}
                `);
            }
            
            clearCache() {
                if (window.smartGenderDetection) {
                    window.smartGenderDetection.clearCache();
                    this.log('üóëÔ∏è Cache de an√°lise limpo');
                }
            }
            
            clearResults() {
                document.getElementById('analysisGrid').innerHTML = '';
                document.getElementById('results').innerHTML = 'Resultados limpos...';
                document.getElementById('progressFill').style.width = '0%';
                document.getElementById('progressText').textContent = 'Aguardando in√≠cio dos testes...';
                this.analysisResults = [];
                this.updateStats();
            }
            
            log(message) {
                const resultsElement = document.getElementById('results');
                const timestamp = new Date().toLocaleTimeString();
                resultsElement.innerHTML += `[${timestamp}] ${message}\n`;
                resultsElement.scrollTop = resultsElement.scrollHeight;
                
                // Manter apenas as √∫ltimas 30 linhas
                const lines = resultsElement.innerHTML.split('\n');
                if (lines.length > 30) {
                    resultsElement.innerHTML = lines.slice(-30).join('\n');
                }
            }
        }
        
        // Inicializar quando a p√°gina carregar
        document.addEventListener('DOMContentLoaded', function() {
            window.visualTester = new VisualAnalysisTester();
        });
    </script>
</body>
</html>
