<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üîç Investigador Viajovem - HabboHub</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background: #f0f0f0;
        }
        .investigator-container {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .section {
            background: #e8f4fd;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            border-left: 4px solid #2196F3;
        }
        .results {
            background: #f9f9f9;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            font-family: monospace;
            font-size: 12px;
            max-height: 400px;
            overflow-y: auto;
        }
        button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #45a049;
        }
        iframe {
            width: 100%;
            height: 600px;
            border: 1px solid #ddd;
            border-radius: 8px;
        }
        .clothing-item {
            border: 1px solid #ddd;
            border-radius: 6px;
            padding: 10px;
            margin: 5px;
            background: white;
            display: inline-block;
            width: 80px;
            text-align: center;
        }
        .clothing-item img {
            width: 100%;
            height: 60px;
            object-fit: contain;
            border-radius: 4px;
        }
        .clothing-item .item-name {
            font-size: 10px;
            margin-top: 5px;
            color: #666;
        }
    </style>
</head>
<body>
    <div class="investigator-container">
        <h1>üîç Investigador Viajovem</h1>
        <p>Este investigador analisa o editor do Viajovem para extrair IDs reais de roupas do Habbo.</p>
        
        <div class="section">
            <h3>üìã M√©todos de Investiga√ß√£o</h3>
            <p>Escolha como quer investigar o editor:</p>
            
            <button onclick="openViajovem()">üåê Abrir Editor Viajovem</button>
            <button onclick="analyzeIframe()">üîç Analisar Iframe</button>
            <button onclick="extractClothingData()">üëï Extrair Dados de Roupas</button>
            <button onclick="testHabboImaging()">üéØ Testar IDs Habbo Imaging</button>
        </div>
        
        <div class="section">
            <h3>üéØ Resultados da Investiga√ß√£o</h3>
            <div id="investigationResults" class="results">
                Clique em um m√©todo para come√ßar a investiga√ß√£o...
            </div>
        </div>
        
        <div class="section">
            <h3>üìä Dados Extra√≠dos</h3>
            <div id="extractedData" class="results">
                Nenhum dado extra√≠do ainda...
            </div>
        </div>
        
        <div class="section">
            <h3>üåê Preview do Editor (Iframe)</h3>
            <div id="iframeContainer">
                <p>Clique em "Abrir Editor Viajovem" para carregar o iframe...</p>
            </div>
        </div>
        
        <div class="section">
            <h3>üëï Grid de Roupas Extra√≠das</h3>
            <div id="clothingGrid">
                <p>Roupas extra√≠das aparecer√£o aqui...</p>
            </div>
        </div>
    </div>

    <script>
        let investigationData = {};
        let extractedClothes = [];
        
        // Fun√ß√£o para abrir o editor do Viajovem em iframe
        function openViajovem() {
            console.log('üåê === ABRINDO EDITOR VIAJOVEM ===');
            
            const container = document.getElementById('iframeContainer');
            container.innerHTML = `
                <iframe 
                    src="https://viajovem.blogspot.com/p/roupas_4.html" 
                    id="viajovemFrame"
                    onload="onIframeLoaded()"
                ></iframe>
            `;
            
            updateResults('‚úÖ Iframe do Viajovem carregado! Aguarde o carregamento completo...');
        }
        
        // Quando o iframe carregar
        function onIframeLoaded() {
            console.log('üéØ Iframe carregado!');
            updateResults('üéØ Iframe carregado com sucesso! Agora podemos analisar o conte√∫do.');
            
            // Aguardar um pouco para o conte√∫do carregar
            setTimeout(() => {
                analyzeIframe();
            }, 3000);
        }
        
        // Analisar o conte√∫do do iframe
        function analyzeIframe() {
            console.log('üîç === ANALISANDO IFRAME ===');
            
            try {
                const iframe = document.getElementById('viajovemFrame');
                if (!iframe || !iframe.contentDocument) {
                    updateResults('‚ùå N√£o foi poss√≠vel acessar o conte√∫do do iframe (CORS)');
                    return;
                }
                
                const doc = iframe.contentDocument;
                console.log('üìÑ Documento do iframe:', doc);
                
                // Procurar por elementos de roupas
                const clothingElements = doc.querySelectorAll('[class*="clothing"], [class*="item"], [class*="grid"], [class*="clothes"]');
                console.log('üëï Elementos de roupas encontrados:', clothingElements.length);
                
                // Procurar por imagens de roupas
                const clothingImages = doc.querySelectorAll('img[src*="habbo"], img[src*="figure"], img[src*="avatar"]');
                console.log('üñºÔ∏è Imagens de roupas encontradas:', clothingImages.length);
                
                // Procurar por links de roupas
                const clothingLinks = doc.querySelectorAll('a[href*="habbo"], a[href*="figure"], a[href*="avatar"]');
                console.log('üîó Links de roupas encontrados:', clothingLinks.length);
                
                // Procurar por scripts que carregam dados
                const scripts = doc.querySelectorAll('script');
                console.log('üìú Scripts encontrados:', scripts.length);
                
                updateResults(`üîç An√°lise do iframe conclu√≠da:
                - Elementos de roupas: ${clothingElements.length}
                - Imagens de roupas: ${clothingImages.length}
                - Links de roupas: ${clothingLinks.length}
                - Scripts: ${scripts.length}
                
                Verifique o console para mais detalhes.`);
                
                // Tentar extrair dados das imagens
                if (clothingImages.length > 0) {
                    extractDataFromImages(clothingImages);
                }
                
            } catch (error) {
                console.error('‚ùå Erro ao analisar iframe:', error);
                updateResults(`‚ùå Erro ao analisar iframe: ${error.message}`);
            }
        }
        
        // Extrair dados das imagens encontradas
        function extractDataFromImages(images) {
            console.log('üîç === EXTRAINDO DADOS DAS IMAGENS ===');
            
            images.forEach((img, index) => {
                const src = img.src;
                const alt = img.alt;
                const title = img.title;
                
                console.log(`üñºÔ∏è Imagem ${index + 1}:`, { src, alt, title });
                
                // Tentar extrair IDs de figura do Habbo
                const figureMatch = src.match(/figure=([^&]+)/);
                if (figureMatch) {
                    const figureId = figureMatch[1];
                    console.log(`üéØ ID de figura encontrado: ${figureId}`);
                    
                    extractedClothes.push({
                        type: 'figure',
                        id: figureId,
                        src: src,
                        alt: alt,
                        title: title
                    });
                }
                
                // Tentar extrair outros padr√µes
                const habboMatch = src.match(/habbo[^/]*\/([^?]+)/);
                if (habboMatch) {
                    const habboPath = habboMatch[1];
                    console.log(`üéØ Caminho Habbo encontrado: ${habboPath}`);
                    
                    extractedClothes.push({
                        type: 'habbo_path',
                        id: habboPath,
                        src: src,
                        alt: alt,
                        title: title
                    });
                }
            });
            
            updateResults(`‚úÖ ${extractedClothes.length} itens de roupa extra√≠dos das imagens!`);
            updateExtractedData();
            renderExtractedClothes();
        }
        
        // Extrair dados de roupas do DOM
        function extractClothingData() {
            console.log('üëï === EXTRAINDO DADOS DE ROUPAS ===');
            
            try {
                const iframe = document.getElementById('viajovemFrame');
                if (!iframe || !iframe.contentDocument) {
                    updateResults('‚ùå Iframe n√£o carregado! Abra primeiro.');
                    return;
                }
                
                const doc = iframe.contentDocument;
                
                // Procurar por todos os elementos que podem conter roupas
                const selectors = [
                    'img[src*="habbo"]',
                    'img[src*="figure"]',
                    'img[src*="avatar"]',
                    'a[href*="habbo"]',
                    'a[href*="figure"]',
                    'a[href*="avatar"]',
                    '[class*="clothing"]',
                    '[class*="item"]',
                    '[class*="clothes"]'
                ];
                
                let totalFound = 0;
                selectors.forEach(selector => {
                    const elements = doc.querySelectorAll(selector);
                    totalFound += elements.length;
                    console.log(`üîç ${selector}: ${elements.length} elementos`);
                });
                
                updateResults(`üîç Total de elementos encontrados: ${totalFound}`);
                
                // Tentar extrair dados de cada elemento
                selectors.forEach(selector => {
                    const elements = doc.querySelectorAll(selector);
                    elements.forEach((element, index) => {
                        if (index < 50) { // Limitar para n√£o sobrecarregar
                            analyzeElement(element);
                        }
                    });
                });
                
            } catch (error) {
                console.error('‚ùå Erro ao extrair dados:', error);
                updateResults(`‚ùå Erro ao extrair dados: ${error.message}`);
            }
        }
        
        // Analisar um elemento individual
        function analyzeElement(element) {
            const tagName = element.tagName.toLowerCase();
            const className = element.className;
            const id = element.id;
            const src = element.src || '';
            const href = element.href || '';
            const alt = element.alt || '';
            const title = element.title || '';
            
            // Verificar se parece ser uma roupa
            if (src.includes('habbo') || src.includes('figure') || src.includes('avatar') ||
                href.includes('habbo') || href.includes('figure') || href.includes('avatar') ||
                className.toLowerCase().includes('clothing') || className.toLowerCase().includes('clothes') ||
                className.toLowerCase().includes('item')) {
                
                console.log(`üéØ Elemento de roupa encontrado:`, {
                    tagName, className, id, src, href, alt, title
                });
                
                // Tentar extrair ID de figura
                const figureMatch = (src + href).match(/figure=([^&]+)/);
                if (figureMatch) {
                    const figureId = figureMatch[1];
                    console.log(`üéØ ID de figura extra√≠do: ${figureId}`);
                    
                    extractedClothes.push({
                        type: 'figure',
                        id: figureId,
                        src: src,
                        href: href,
                        alt: alt,
                        title: title,
                        className: className
                    });
                }
            }
        }
        
        // Testar IDs do Habbo Imaging
        function testHabboImaging() {
            console.log('üéØ === TESTANDO IDS HABBO IMAGING ===');
            
            if (extractedClothes.length === 0) {
                updateResults('‚ùå Nenhuma roupa extra√≠da! Extraia dados primeiro.');
                return;
            }
            
            updateResults('üéØ Testando IDs extra√≠dos no Habbo Imaging...');
            
            // Testar alguns IDs
            const testIds = extractedClothes.slice(0, 5);
            testIds.forEach((item, index) => {
                if (item.type === 'figure') {
                    const testUrl = `https://www.habbo.com/habbo-imaging/avatarimage?figure=${item.id}&size=M`;
                    console.log(`üß™ Testando ID ${index + 1}: ${item.id}`);
                    console.log(`üîó URL de teste: ${testUrl}`);
                    
                    // Criar elemento de teste
                    const testImg = document.createElement('img');
                    testImg.src = testUrl;
                    testImg.style.cssText = 'width: 60px; height: 60px; border: 1px solid #ddd; margin: 5px;';
                    testImg.onload = () => {
                        console.log(`‚úÖ ID ${item.id} funcionou!`);
                        updateResults(`‚úÖ ID ${item.id} funcionou no Habbo Imaging!`);
                    };
                    testImg.onerror = () => {
                        console.log(`‚ùå ID ${item.id} falhou!`);
                        updateResults(`‚ùå ID ${item.id} falhou no Habbo Imaging!`);
                    };
                    
                    // Adicionar ao grid de teste
                    const testContainer = document.createElement('div');
                    testContainer.className = 'clothing-item';
                    testContainer.appendChild(testImg);
                    testContainer.appendChild(document.createElement('div')).textContent = item.id;
                    
                    document.getElementById('clothingGrid').appendChild(testContainer);
                }
            });
        }
        
        // Renderizar roupas extra√≠das
        function renderExtractedClothes() {
            const grid = document.getElementById('clothingGrid');
            grid.innerHTML = '<h4>üëï Roupas Extra√≠das:</h4>';
            
            extractedClothes.forEach((item, index) => {
                const clothingItem = document.createElement('div');
                clothingItem.className = 'clothing-item';
                
                if (item.src) {
                    const img = document.createElement('img');
                    img.src = item.src;
                    img.alt = item.alt || item.title || `Item ${index + 1}`;
                    clothingItem.appendChild(img);
                }
                
                const itemName = document.createElement('div');
                itemName.className = 'item-name';
                itemName.textContent = `${item.type}: ${item.id}`;
                clothingItem.appendChild(itemName);
                
                grid.appendChild(clothingItem);
            });
        }
        
        // Fun√ß√µes auxiliares
        function updateResults(message) {
            const results = document.getElementById('investigationResults');
            const timestamp = new Date().toLocaleTimeString();
            results.innerHTML += `<br>[${timestamp}] ${message}`;
            results.scrollTop = results.scrollHeight;
        }
        
        function updateExtractedData() {
            const container = document.getElementById('extractedData');
            container.innerHTML = `
                <h4>üìä Dados Extra√≠dos (${extractedClothes.length} itens):</h4>
                <pre>${JSON.stringify(extractedClothes, null, 2)}</pre>
            `;
        }
        
        // Inicializa√ß√£o
        console.log('üîç Investigador Viajovem inicializado!');
        updateResults('üöÄ Sistema de investiga√ß√£o inicializado!');
    </script>
</body>
</html>
